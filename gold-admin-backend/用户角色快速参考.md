# ğŸ‘¥ ç”¨æˆ·å’Œè§’è‰²ç®¡ç† - å¿«é€Ÿå‚è€ƒå¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ¼”ç¤ºè„šæœ¬
```bash
cd gold-admin-backend
chmod +x test_user_role.sh
./test_user_role.sh
```

---

## ğŸ“‹ API å¿«é€Ÿå‚è€ƒ

### ç”¨æˆ·ç®¡ç†

| æ“ä½œ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–åˆ—è¡¨ | GET | `/api/users?page=1&page_size=10` | åˆ†é¡µæŸ¥è¯¢ |
| è·å–è¯¦æƒ… | GET | `/api/users/:id` | åŒ…å«è§’è‰²ä¿¡æ¯ |
| åˆ›å»ºç”¨æˆ· | POST | `/api/users` | å¯åŒæ—¶åˆ†é…è§’è‰² |
| æ›´æ–°ç”¨æˆ· | PUT | `/api/users/:id` | å¯ä¿®æ”¹è§’è‰² |
| åˆ é™¤ç”¨æˆ· | DELETE | `/api/users/:id` | ä¸èƒ½åˆ é™¤ID=1 |
| ä¿®æ”¹å¯†ç  | PUT | `/api/users/:id/password` | é‡ç½®å¯†ç  |

### è§’è‰²ç®¡ç†

| æ“ä½œ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–åˆ—è¡¨ | GET | `/api/roles?page=1&page_size=10` | åˆ†é¡µæŸ¥è¯¢ |
| è·å–æ‰€æœ‰ | GET | `/api/roles/all` | ä¸åˆ†é¡µï¼ˆä¸‹æ‹‰ç”¨ï¼‰ |
| è·å–è¯¦æƒ… | GET | `/api/roles/:id` | åŒ…å«èœå•ä¿¡æ¯ |
| åˆ›å»ºè§’è‰² | POST | `/api/roles` | å¯åŒæ—¶åˆ†é…èœå• |
| æ›´æ–°è§’è‰² | PUT | `/api/roles/:id` | å¯ä¿®æ”¹èœå• |
| åˆ é™¤è§’è‰² | DELETE | `/api/roles/:id` | ä¸èƒ½åˆ é™¤super_admin |

---

## ğŸ’¡ å¸¸ç”¨å‘½ä»¤

### 1. åˆ›å»ºç”¨æˆ·å¹¶åˆ†é…è§’è‰²
```bash
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "username": "test001",
    "password": "123456",
    "real_name": "æµ‹è¯•ç”¨æˆ·",
    "status": 1,
    "role_ids": [3]
  }'
```

### 2. ä¿®æ”¹ç”¨æˆ·è§’è‰²
```bash
curl -X PUT http://localhost:8080/api/users/2 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "role_ids": [1, 2]
  }'
```

### 3. åˆ›å»ºè‡ªå®šä¹‰è§’è‰²
```bash
curl -X POST http://localhost:8080/api/roles \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "name": "è‡ªå®šä¹‰è§’è‰²",
    "code": "custom_role",
    "description": "è‡ªå®šä¹‰è§’è‰²æè¿°",
    "status": 1,
    "menu_ids": [1, 2, 5]
  }'
```

### 4. æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²å’Œæƒé™
```bash
# è·å–ç”¨æˆ·è¯¦æƒ…ï¼ˆåŒ…å«è§’è‰²IDï¼‰
curl -H "Authorization: Bearer <token>" \
  http://localhost:8080/api/users/2 | jq

# è·å–è§’è‰²è¯¦æƒ…ï¼ˆåŒ…å«èœå•IDï¼‰
curl -H "Authorization: Bearer <token>" \
  http://localhost:8080/api/roles/1 | jq
```

---

## ğŸ¯ é¢„è®¾è§’è‰²

| ID | è§’è‰²åç§° | è§’è‰²ä»£ç  | æƒé™èŒƒå›´ |
|----|----------|----------|----------|
| 1 | è¶…çº§ç®¡ç†å‘˜ | super_admin | å…¨éƒ¨æƒé™ |
| 2 | æ€»éƒ¨åº—é•¿ | head_manager | æ‰€æœ‰åº—é“º |
| 3 | å•åº—åº—é•¿ | shop_manager | å•ä¸ªåº—é“º |
| 4 | åº—å‘˜ | shop_staff | åªè¯» |
| 5 | è´¢åŠ¡ | finance | æŸ¥çœ‹/å¯¼å‡º |

---

## ğŸ”‘ é»˜è®¤è´¦å·

```
ç”¨æˆ·å: admin
å¯†ç : admin123
è§’è‰²: è¶…çº§ç®¡ç†å‘˜
```

---

## ğŸ“Š æƒé™å…³ç³»å›¾

```
ç”¨æˆ· (AdminUser)
  â†“ (user_rolesè¡¨)
è§’è‰² (Role)
  â†“ (role_menusè¡¨)
èœå• (Menu)
```

---

## ğŸ”’ å®‰å…¨è§„åˆ™

### âœ… å¯ä»¥åšçš„
- âœ… ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²
- âœ… ä¸€ä¸ªè§’è‰²å¯ä»¥æœ‰å¤šä¸ªèœå•
- âœ… è§’è‰²å¯ä»¥éšæ—¶æ·»åŠ /åˆ é™¤èœå•
- âœ… ç”¨æˆ·å¯ä»¥éšæ—¶ä¿®æ”¹è§’è‰²

### âŒ ä¸èƒ½åšçš„
- âŒ ä¸èƒ½åˆ é™¤ID=1çš„ç”¨æˆ·
- âŒ ä¸èƒ½ä¿®æ”¹super_adminè§’è‰²
- âŒ ä¸èƒ½åˆ é™¤super_adminè§’è‰²
- âŒ ä¸èƒ½åˆ é™¤å·²åˆ†é…ç»™ç”¨æˆ·çš„è§’è‰²

---

## ğŸ’» å‰ç«¯ä»£ç ç¤ºä¾‹

### è·å–ç”¨æˆ·åˆ—è¡¨
```javascript
import { getUserList } from '@/api/user'

const queryParams = {
  page: 1,
  page_size: 10,
  username: 'admin',
  status: 1
}

const res = await getUserList(queryParams)
console.log(res.data.list)  // ç”¨æˆ·åˆ—è¡¨
console.log(res.data.total) // æ€»æ•°
```

### åˆ†é…è§’è‰²
```javascript
import { updateUser } from '@/api/user'

await updateUser(userId, {
  role_ids: [1, 2, 3]  // åˆ†é…å¤šä¸ªè§’è‰²
})
```

### è·å–æ‰€æœ‰è§’è‰²ï¼ˆä¸‹æ‹‰æ¡†ï¼‰
```javascript
import { getAllRoles } from '@/api/role'

const res = await getAllRoles()
const roleOptions = res.data.map(role => ({
  label: role.name,
  value: role.id
}))
```

---

## ğŸ” å¿«é€ŸæŸ¥è¯¢

### æŸ¥è¯¢ç”¨æˆ·æ‹¥æœ‰å“ªäº›è§’è‰²
```sql
SELECT r.name, r.code
FROM user_roles ur
JOIN roles r ON ur.role_id = r.id
WHERE ur.user_id = 2;
```

### æŸ¥è¯¢è§’è‰²æ‹¥æœ‰å“ªäº›èœå•
```sql
SELECT m.title, m.path
FROM role_menus rm
JOIN menus m ON rm.menu_id = m.id
WHERE rm.role_id = 1;
```

### æŸ¥è¯¢æŸä¸ªè§’è‰²çš„æ‰€æœ‰ç”¨æˆ·
```sql
SELECT u.username, u.real_name
FROM user_roles ur
JOIN admin_users u ON ur.user_id = u.id
WHERE ur.role_id = 3;
```

---

## âš¡ å¸¸è§æ“ä½œåœºæ™¯

### åœºæ™¯1: æ–°å‘˜å·¥å…¥èŒ
```bash
# 1. åˆ›å»ºç”¨æˆ·
POST /api/users
{
  "username": "employee001",
  "password": "123456",
  "real_name": "å¼ ä¸‰",
  "role_ids": [4]  # åˆ†é…åº—å‘˜è§’è‰²
}

# 2. é€šçŸ¥ç”¨æˆ·ç™»å½•ä¿¡æ¯
# ç”¨æˆ·å: employee001
# åˆå§‹å¯†ç : 123456
# è¦æ±‚ç”¨æˆ·é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç 
```

### åœºæ™¯2: å‘˜å·¥å‡èŒ
```bash
# å°†åº—å‘˜å‡çº§ä¸ºåº—é•¿
PUT /api/users/5
{
  "role_ids": [3]  # æ”¹ä¸ºå•åº—åº—é•¿
}
```

### åœºæ™¯3: å‘˜å·¥ç¦»èŒ
```bash
# æ–¹å¼1: ç¦ç”¨è´¦å·
PUT /api/users/5
{
  "status": 0
}

# æ–¹å¼2: åˆ é™¤è´¦å·
DELETE /api/users/5
```

### åœºæ™¯4: ä¸´æ—¶æƒé™
```bash
# ç»™è´¢åŠ¡ä¸´æ—¶æ·»åŠ ç”¨æˆ·ç®¡ç†æƒé™
# 1. ä¿®æ”¹è´¢åŠ¡è§’è‰²çš„èœå•
PUT /api/roles/5
{
  "menu_ids": [1, 2, 3, ...]  # æ·»åŠ ç”¨æˆ·ç®¡ç†èœå•
}

# 2. æ“ä½œå®Œæˆåç§»é™¤
PUT /api/roles/5
{
  "menu_ids": [...]  # æ¢å¤åŸæœ‰èœå•
}
```

---

## ğŸ“ å¸®åŠ©

- è¯¦ç»†æ–‡æ¡£: [ç”¨æˆ·å’Œè§’è‰²ç®¡ç†æŒ‡å—.md](./ç”¨æˆ·å’Œè§’è‰²ç®¡ç†æŒ‡å—.md)
- APIæ–‡æ¡£: [API.md](./API.md)
- æµ‹è¯•è„šæœ¬: `./test_user_role.sh`

---

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°**: 2025-11-04





