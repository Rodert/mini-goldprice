# 🔗 前后端联调测试指南

**测试时间**: 2025-11-04  
**前端地址**: http://localhost:9527  
**后端地址**: http://localhost:8080

---

## 📋 测试前准备

### 1. 确认服务运行状态

#### 后端服务（必须先启动）
```bash
# 终端1：启动后端
cd gold-admin-backend
go run main.go

# 看到以下输出表示成功：
# ========================================
# 初始化数据完成！
# 默认管理员账号：admin
# 默认密码：admin123
# ========================================
# 服务器启动成功，监听地址: :8080
```

#### 前端服务
```bash
# 终端2：启动前端
cd gold-admin-frontend
npm run dev

# 看到以下输出表示成功：
# App running at:
# - Local:   http://localhost:9527/
```

---

## 🧪 测试用例清单

### ✅ 测试用例 1: 登录功能

**测试步骤**:
1. 浏览器打开 http://localhost:9527
2. 应该自动跳转到登录页
3. 输入账号：`admin`
4. 输入密码：`admin123`
5. 点击"登录"按钮

**预期结果**:
- ✅ 登录成功，跳转到首页
- ✅ 右上角显示用户名"系统管理员"
- ✅ 左侧菜单正常显示

**测试重点**:
- 前端发送登录请求到 `/api/login`
- 后端返回 token 和用户信息
- 前端保存 token 到 localStorage
- 前端加载用户菜单权限

**检查点**:
```javascript
// 打开浏览器控制台，查看 localStorage
localStorage.getItem('token')  // 应该有值
localStorage.getItem('user')   // 应该有用户信息
```

---

### ✅ 测试用例 2: 首页看板

**测试步骤**:
1. 登录成功后，查看首页
2. 观察统计数据卡片
3. 查看最近动态列表
4. 查看预约趋势图表

**预期结果**:
- ✅ 显示今日预约数、待处理数、本月预约数
- ✅ 显示店铺总数、价格品种数、用户数
- ✅ 最近动态列表显示正常
- ✅ 趋势图表正常渲染

**API 调用**:
- `GET /api/dashboard/stats` - 统计数据
- `GET /api/dashboard/activities` - 最近动态
- `GET /api/dashboard/trend` - 预约趋势

**检查点**:
```javascript
// 浏览器控制台 Network 标签
// 应该看到以下请求：
// GET /api/dashboard/stats - 200 OK
// GET /api/dashboard/activities - 200 OK
// GET /api/dashboard/trend - 200 OK
```

---

### ✅ 测试用例 3: 用户管理

**测试步骤**:
1. 点击"系统管理" → "用户管理"
2. 查看用户列表
3. 点击"新增用户"按钮
4. 填写用户信息：
   - 用户名：test001
   - 真实姓名：测试用户
   - 手机号：13800138001
   - 密码：123456
5. 选择角色：超级管理员
6. 点击"确定"

**预期结果**:
- ✅ 用户列表正常显示
- ✅ 创建用户成功
- ✅ 列表自动刷新
- ✅ 显示成功提示

**API 调用**:
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 创建用户
- `GET /api/roles/all` - 获取角色列表（下拉框）

**检查点**:
```javascript
// 查看请求响应
// POST /api/users
{
  "code": 200,
  "message": "创建成功",
  "data": { "id": 2, "username": "test001", ... }
}
```

---

### ✅ 测试用例 4: 角色管理

**测试步骤**:
1. 点击"系统管理" → "角色管理"
2. 查看角色列表
3. 点击"新增角色"
4. 填写角色信息：
   - 角色名称：测试角色
   - 角色代码：test_role
   - 描述：测试用角色
5. 选择菜单权限（勾选菜单树）
6. 点击"确定"

**预期结果**:
- ✅ 角色列表正常显示
- ✅ 创建角色成功
- ✅ 菜单树正常渲染
- ✅ 权限分配成功

**API 调用**:
- `GET /api/roles` - 获取角色列表
- `GET /api/menus` - 获取菜单树
- `POST /api/roles` - 创建角色

---

### ✅ 测试用例 5: 菜单管理

**测试步骤**:
1. 点击"系统管理" → "菜单管理"
2. 查看菜单树
3. 点击"新增菜单"
4. 选择父菜单：系统管理
5. 填写菜单信息：
   - 菜单名称：test-menu
   - 菜单标题：测试菜单
   - 菜单类型：菜单
   - 路由路径：test
   - 组件路径：test/index
6. 点击"确定"

**预期结果**:
- ✅ 菜单树正常显示（树形结构）
- ✅ 创建菜单成功
- ✅ 树自动刷新
- ✅ 新菜单出现在系统管理下

**API 调用**:
- `GET /api/menus` - 获取菜单树
- `POST /api/menus` - 创建菜单

---

### ✅ 测试用例 6: 价格管理

**测试步骤**:
1. 点击"业务管理" → "价格管理"
2. 查看价格列表（卡片形式）
3. 点击某个价格卡片的"编辑"按钮
4. 修改价格信息：
   - 基础价格：565.00
   - 回购差价：-12.00
   - 销售差价：+18.00
5. 点击"确定"

**预期结果**:
- ✅ 价格列表以卡片形式展示
- ✅ 显示回购价、销售价（自动计算）
- ✅ 编辑价格成功
- ✅ 价格实时更新
- ✅ 自动计算：回购价 = 565 - 12 = 553
- ✅ 自动计算：销售价 = 565 + 18 = 583

**API 调用**:
- `GET /api/prices` - 获取价格列表
- `PUT /api/prices/:id` - 更新价格

**核心验证**:
```javascript
// 响应数据应包含计算后的价格
{
  "base_price": 565,
  "buy_price_diff": -12,
  "sell_price_diff": 18,
  "buy_price": 553,   // ✓ 自动计算
  "sell_price": 583   // ✓ 自动计算
}
```

---

### ✅ 测试用例 7: 店铺管理

**测试步骤**:
1. 点击"业务管理" → "店铺管理"
2. 查看店铺列表
3. 点击"新增店铺"
4. 填写店铺信息：
   - 店铺名称：沪金汇测试店
   - 店铺代码：shop_test
   - 地址：上海市徐汇区XXX号
   - 电话：021-88888888
   - 手机：13900000000
   - 营业时间：周一至周日 09:00-18:00
5. 点击"确定"

**预期结果**:
- ✅ 店铺列表正常显示
- ✅ 创建店铺成功
- ✅ 列表自动刷新

**API 调用**:
- `GET /api/shops` - 获取店铺列表
- `POST /api/shops` - 创建店铺

---

### ✅ 测试用例 8: 预约管理

**测试步骤**:
1. 点击"业务管理" → "预约管理"
2. 查看预约列表
3. 点击某个预约的"详情"按钮
4. 修改预约状态为"已确认"
5. 添加管理员备注
6. 点击"确定"

**预期结果**:
- ✅ 预约列表正常显示
- ✅ 状态筛选正常
- ✅ 更新预约成功
- ✅ 状态变更记录

**API 调用**:
- `GET /api/appointments` - 获取预约列表
- `GET /api/appointments/:id` - 获取预约详情
- `PUT /api/appointments/:id` - 更新预约

---

### ✅ 测试用例 9: 分页和搜索

**测试步骤**:
1. 在用户列表中测试分页
2. 切换到第2页
3. 修改每页显示数量
4. 使用搜索框搜索用户名
5. 清空搜索条件

**预期结果**:
- ✅ 分页组件正常工作
- ✅ 页码切换正常
- ✅ 每页条数变更正常
- ✅ 搜索结果准确
- ✅ 清空搜索恢复全部数据

**API 调用**:
- `GET /api/users?page=2&page_size=10`
- `GET /api/users?username=admin`

---

### ✅ 测试用例 10: 权限验证

**测试步骤**:
1. 创建一个新用户（权限受限）
2. 分配"店员"角色
3. 登出当前账号
4. 使用新用户登录
5. 查看左侧菜单

**预期结果**:
- ✅ 不同角色看到不同菜单
- ✅ 无权限的菜单不显示
- ✅ 访问无权限页面自动跳转

**检查点**:
- 超级管理员：看到所有菜单
- 店员：只能看到部分菜单（只读）

---

### ✅ 测试用例 11: 错误处理

**测试步骤**:
1. 故意输入错误的登录密码
2. 提交空表单
3. 删除正在使用的角色
4. Token 过期后操作

**预期结果**:
- ✅ 显示友好的错误提示
- ✅ 表单验证正常工作
- ✅ 业务逻辑验证正常
- ✅ Token 过期自动跳转登录

---

### ✅ 测试用例 12: 登出功能

**测试步骤**:
1. 点击右上角用户头像
2. 点击"退出登录"
3. 确认退出

**预期结果**:
- ✅ 调用登出接口
- ✅ 清除本地 token
- ✅ 跳转到登录页
- ✅ 再次访问需要重新登录

**API 调用**:
- `POST /api/logout`

**检查点**:
```javascript
// 退出后检查
localStorage.getItem('token')  // 应该为 null
```

---

## 🔍 关键检查点

### 1. 网络请求检查

**打开浏览器开发者工具 → Network 标签**

所有请求应该：
- ✅ 请求头包含 `Authorization: Bearer <token>`
- ✅ 响应状态码为 200
- ✅ 响应格式为：`{ code: 200, data: {...}, message: "success" }`

### 2. 跨域检查

前端（9527）访问后端（8080）：
- ✅ 无跨域错误
- ✅ OPTIONS 预检请求成功
- ✅ 代理配置正常工作

### 3. 状态管理检查

```javascript
// 控制台执行
console.log(this.$store.state.user.token)  // 查看 token
console.log(this.$store.state.user.name)   // 查看用户名
console.log(this.$store.getters.roles)     // 查看角色
```

### 4. 路由检查

- ✅ 动态路由正常加载
- ✅ 权限路由守卫正常工作
- ✅ 404 页面正常显示

---

## 🐛 常见问题排查

### 问题1: 登录后白屏

**原因**: 可能是菜单数据格式不匹配

**排查**:
```javascript
// 控制台查看
localStorage.getItem('menu')
```

**解决**: 检查后端返回的菜单树格式是否正确

---

### 问题2: 请求 404

**原因**: 代理配置问题或 API 路径错误

**排查**:
- 检查 `vue.config.js` 的 proxy 配置
- 检查 API 请求路径是否以 `/api` 开头

**解决**:
```javascript
// vue.config.js
proxy: {
  '/api': {
    target: 'http://localhost:8080',
    changeOrigin: true
  }
}
```

---

### 问题3: CORS 跨域错误

**原因**: 后端 CORS 配置问题

**排查**: 查看浏览器控制台错误信息

**解决**: 检查后端 `middleware/cors.go` 配置

---

### 问题4: Token 无效

**原因**: Token 过期或格式错误

**排查**:
```javascript
// 查看 token
localStorage.getItem('token')

// 查看请求头
// Network → 某个请求 → Headers → Request Headers
// Authorization: Bearer <token>
```

**解决**: 重新登录获取新 token

---

## 📊 性能测试

### 页面加载速度

| 页面 | 预期加载时间 | 状态 |
|------|-------------|------|
| 登录页 | < 1s | ✅ |
| 首页 | < 2s | ✅ |
| 用户列表 | < 1s | ✅ |
| 价格列表 | < 1s | ✅ |

### API 响应速度

| 接口 | 预期响应时间 | 状态 |
|------|-------------|------|
| 登录 | < 200ms | ✅ |
| 用户列表 | < 100ms | ✅ |
| 创建用户 | < 200ms | ✅ |
| 菜单树 | < 100ms | ✅ |

---

## 📝 测试记录模板

### 测试记录表

| 序号 | 测试项 | 测试结果 | 问题描述 | 备注 |
|------|--------|---------|---------|------|
| 1 | 登录功能 | ✅ / ❌ | | |
| 2 | 首页看板 | ✅ / ❌ | | |
| 3 | 用户管理 | ✅ / ❌ | | |
| 4 | 角色管理 | ✅ / ❌ | | |
| 5 | 菜单管理 | ✅ / ❌ | | |
| 6 | 价格管理 | ✅ / ❌ | | |
| 7 | 店铺管理 | ✅ / ❌ | | |
| 8 | 预约管理 | ✅ / ❌ | | |
| 9 | 分页搜索 | ✅ / ❌ | | |
| 10 | 权限验证 | ✅ / ❌ | | |
| 11 | 错误处理 | ✅ / ❌ | | |
| 12 | 登出功能 | ✅ / ❌ | | |

---

## 🎯 自动化测试脚本

创建 `frontend-test.js`:

```javascript
// 前端自动化测试
describe('后台管理系统集成测试', () => {
  
  it('应该能够成功登录', () => {
    cy.visit('http://localhost:9527')
    cy.get('input[name="username"]').type('admin')
    cy.get('input[name="password"]').type('admin123')
    cy.get('button[type="submit"]').click()
    cy.url().should('include', '/dashboard')
  })

  it('应该显示用户列表', () => {
    cy.visit('http://localhost:9527/system/user')
    cy.get('.el-table').should('be.visible')
  })

  // 更多测试用例...
})
```

---

## ✅ 测试完成检查清单

- [ ] 所有页面正常访问
- [ ] 所有 API 接口正常调用
- [ ] 表单提交功能正常
- [ ] 分页和搜索功能正常
- [ ] 权限控制正常
- [ ] 错误提示友好
- [ ] 无控制台错误
- [ ] 无网络请求失败
- [ ] 响应速度符合预期
- [ ] UI 显示正常

---

## 🎉 测试结论模板

**测试时间**: 2025-11-04  
**测试人员**: XXX  
**测试环境**: 
- 后端：http://localhost:8080
- 前端：http://localhost:9527

**测试结果**: 
- 通过测试用例：X / 12
- 发现问题：X 个
- 严重问题：X 个
- 一般问题：X 个

**整体评价**: ⭐⭐⭐⭐⭐

**建议**: 
1. ...
2. ...

---

**文档创建时间**: 2025-11-04  
**最后更新时间**: 2025-11-04  
**文档版本**: v1.0.0


