# å°ç¨‹åºç”Ÿäº§ç¯å¢ƒé…ç½®æŒ‡å—

## ğŸ“‹ ä¸Šçº¿å‰æ£€æŸ¥æ¸…å•

### 1. å°ç¨‹åºç«¯é…ç½®

#### âœ… ä¿®æ”¹ API åœ°å€
**æ–‡ä»¶**: `miniprogram/utils/api.js`

```javascript
const ENV = {
  development: 'http://localhost:8080',
  production: 'https://your-api-domain.com'  // æ›¿æ¢ä¸ºå®é™…åŸŸå
};

const isProduction = true; // æ”¹ä¸º true
```

**æ³¨æ„äº‹é¡¹**:
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ **HTTPS** åè®®
- åŸŸåå¿…é¡»æ˜¯å·²å¤‡æ¡ˆçš„åˆæ³•åŸŸå
- ç¡®ä¿åŸŸåå¯ä»¥æ­£å¸¸è®¿é—®

#### âœ… é…ç½®æœåŠ¡å™¨åŸŸå
**ä½ç½®**: å¾®ä¿¡å…¬ä¼—å¹³å° â†’ å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸå

éœ€è¦é…ç½®ä»¥ä¸‹åŸŸåï¼š

1. **requeståˆæ³•åŸŸå**ï¼ˆå¿…é¡»ï¼‰
   ```
   https://your-api-domain.com
   ```

2. **uploadFileåˆæ³•åŸŸå**ï¼ˆå¦‚æœä¸Šä¼ æ–‡ä»¶ï¼‰
   ```
   https://your-api-domain.com
   ```

3. **downloadFileåˆæ³•åŸŸå**ï¼ˆå¦‚æœä¸‹è½½æ–‡ä»¶ï¼‰
   ```
   https://your-api-domain.com
   ```

**é…ç½®æ­¥éª¤**:
1. ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. è¿›å…¥ **å¼€å‘** â†’ **å¼€å‘ç®¡ç†** â†’ **å¼€å‘è®¾ç½®**
3. æ‰¾åˆ° **æœåŠ¡å™¨åŸŸå** é…ç½®
4. ç‚¹å‡» **ä¿®æ”¹**ï¼Œæ·»åŠ ä½ çš„ API åŸŸå
5. ä¿å­˜é…ç½®ï¼ˆæ¯æœˆå¯ä¿®æ”¹ 5 æ¬¡ï¼‰

#### âœ… å…³é—­æœ¬åœ°è°ƒè¯•è®¾ç½®
**æ–‡ä»¶**: `miniprogram/project.config.json` å’Œ `project.private.config.json`

ç¡®ä¿ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š
```json
{
  "setting": {
    "urlCheck": true  // ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¼€å¯åŸŸåæ ¡éªŒ
  }
}
```

### 2. åç«¯æœåŠ¡é…ç½®

#### âœ… é…ç½® HTTPS
ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPSï¼Œéœ€è¦ï¼š

1. **ç”³è¯· SSL è¯ä¹¦**
   - å¯ä»¥ä½¿ç”¨ Let's Encryptï¼ˆå…è´¹ï¼‰
   - æˆ–è´­ä¹°å•†ä¸š SSL è¯ä¹¦

2. **é…ç½® Nginx åå‘ä»£ç†**ï¼ˆæ¨èï¼‰
   ```nginx
   server {
       listen 443 ssl;
       server_name your-api-domain.com;
       
       ssl_certificate /path/to/cert.pem;
       ssl_certificate_key /path/to/key.pem;
       
       location / {
           proxy_pass http://localhost:8080;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

3. **æˆ–ç›´æ¥åœ¨ Go æœåŠ¡ä¸­é…ç½® HTTPS**
   ```go
   // main.go
   err := http.ListenAndServeTLS(":443", "cert.pem", "key.pem", router)
   ```

#### âœ… æ›´æ–° CORS é…ç½®
**æ–‡ä»¶**: `gold-admin-backend/middleware/cors.go`

æ·»åŠ ç”Ÿäº§ç¯å¢ƒåŸŸåï¼š
```go
allowOrigins := []string{
    "http://localhost:9527",                    // å¼€å‘ç¯å¢ƒ
    "https://your-frontend-domain.com",         // ç”Ÿäº§ç¯å¢ƒå‰ç«¯
    "https://your-api-domain.com",              // ç”Ÿäº§ç¯å¢ƒAPI
}
```

#### âœ… æ›´æ–°é…ç½®æ–‡ä»¶
**æ–‡ä»¶**: `gold-admin-backend/config/config.yaml`

ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š
```yaml
server:
  port: 8080
  mode: release  # æ”¹ä¸º release

jwt:
  secret: your-strong-secret-key-in-production  # ä¿®æ”¹ä¸ºå¼ºå¯†é’¥
  expire: 168

log:
  level: info
  path: ./logs
```

### 3. åŸŸåå’ŒæœåŠ¡å™¨é…ç½®

#### âœ… åŸŸåå‡†å¤‡
1. **è´­ä¹°åŸŸå**ï¼ˆå¦‚ï¼š`your-domain.com`ï¼‰
2. **åŸŸåå¤‡æ¡ˆ**ï¼ˆå›½å†…æœåŠ¡å™¨å¿…é¡»ï¼‰
3. **DNS è§£æé…ç½®**
   - A è®°å½•ï¼š`api.your-domain.com` â†’ æœåŠ¡å™¨IP
   - æˆ– CNAMEï¼š`api.your-domain.com` â†’ æœåŠ¡å™¨åŸŸå

#### âœ… æœåŠ¡å™¨é…ç½®
1. **æœåŠ¡å™¨è¦æ±‚**
   - è‡³å°‘ 2GB å†…å­˜
   - æ”¯æŒ HTTPSï¼ˆ443ç«¯å£ï¼‰
   - é˜²ç«å¢™å¼€æ”¾ 80ã€443 ç«¯å£

2. **éƒ¨ç½²åç«¯æœåŠ¡**
   ```bash
   # ç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬
   go build -o gold-admin-backend main.go
   
   # ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡
   sudo systemctl start gold-admin-backend
   ```

### 4. å°ç¨‹åºå‘å¸ƒ

#### âœ… ä¸Šä¼ ä»£ç 
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡» **ä¸Šä¼ **
2. å¡«å†™ç‰ˆæœ¬å·å’Œé¡¹ç›®å¤‡æ³¨
3. ä¸Šä¼ æˆåŠŸåï¼Œåœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æäº¤å®¡æ ¸

#### âœ… æäº¤å®¡æ ¸
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
2. è¿›å…¥ **ç‰ˆæœ¬ç®¡ç†** â†’ **å¼€å‘ç‰ˆæœ¬**
3. ç‚¹å‡» **æäº¤å®¡æ ¸**
4. å¡«å†™å®¡æ ¸ä¿¡æ¯ï¼Œä¸Šä¼ å°ç¨‹åºæˆªå›¾
5. ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸ 1-7 ä¸ªå·¥ä½œæ—¥ï¼‰

#### âœ… å‘å¸ƒä¸Šçº¿
1. å®¡æ ¸é€šè¿‡åï¼Œåœ¨ **ç‰ˆæœ¬ç®¡ç†** â†’ **å®¡æ ¸ç‰ˆæœ¬** ä¸­
2. ç‚¹å‡» **å‘å¸ƒ**ï¼Œå°ç¨‹åºæ­£å¼ä¸Šçº¿

## ğŸ”’ å®‰å…¨é…ç½®

### 1. API å®‰å…¨
- âœ… ä½¿ç”¨ HTTPS åŠ å¯†ä¼ è¾“
- âœ… é…ç½® CORS ç™½åå•
- âœ… ä½¿ç”¨å¼º JWT Secret
- âœ… å¯ç”¨è¯·æ±‚é¢‘ç‡é™åˆ¶
- âœ… æ·»åŠ æ¥å£ç­¾åéªŒè¯ï¼ˆå¯é€‰ï¼‰

### 2. æ•°æ®å®‰å…¨
- âœ… æ•°æ®åº“è¿æ¥åŠ å¯†
- âœ… æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- âœ… å®šæœŸå¤‡ä»½æ•°æ®
- âœ… æ—¥å¿—è„±æ•å¤„ç†

### 3. æœåŠ¡å™¨å®‰å…¨
- âœ… å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… ä½¿ç”¨å¼ºå¯†ç 
- âœ… ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### 1. æ—¥å¿—ç›‘æ§
- é…ç½®æ—¥å¿—æ”¶é›†ï¼ˆå¦‚ ELKã€Grafanaï¼‰
- ç›‘æ§ API å“åº”æ—¶é—´
- ç›‘æ§é”™è¯¯ç‡

### 2. æ€§èƒ½ç›‘æ§
- ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨
- ç›‘æ§æ•°æ®åº“æ€§èƒ½
- é…ç½®å‘Šè­¦è§„åˆ™

### 3. å¤‡ä»½ç­–ç•¥
- æ•°æ®åº“å®šæœŸå¤‡ä»½
- é…ç½®æ–‡ä»¶å¤‡ä»½
- ä»£ç ç‰ˆæœ¬ç®¡ç†

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. å¼€å‘ç¯å¢ƒæµ‹è¯•
```bash
# æœ¬åœ°æµ‹è¯•
npm run dev
# æˆ–
go run main.go
```

### 2. é¢„å‘å¸ƒç¯å¢ƒæµ‹è¯•
```bash
# éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨
# ä½¿ç”¨æµ‹è¯•åŸŸåè¿›è¡Œå®Œæ•´æµ‹è¯•
```

### 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# 1. ç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬
go build -o gold-admin-backend main.go

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp gold-admin-backend user@server:/path/to/app/

# 3. é‡å¯æœåŠ¡
sudo systemctl restart gold-admin-backend

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status gold-admin-backend
```

## âš ï¸ å¸¸è§é—®é¢˜

### 1. åŸŸåæ ¡éªŒå¤±è´¥
**é—®é¢˜**: å°ç¨‹åºæç¤ºåŸŸåä¸åœ¨åˆæ³•åˆ—è¡¨ä¸­

**è§£å†³**:
- æ£€æŸ¥å¾®ä¿¡å…¬ä¼—å¹³å°åŸŸåé…ç½®
- ç¡®ä¿ä½¿ç”¨ HTTPS
- æ£€æŸ¥åŸŸåæ˜¯å¦æ­£ç¡®

### 2. CORS è·¨åŸŸé”™è¯¯
**é—®é¢˜**: æµè§ˆå™¨æç¤ºè·¨åŸŸé”™è¯¯

**è§£å†³**:
- æ£€æŸ¥åç«¯ CORS é…ç½®
- ç¡®ä¿å…è®¸çš„åŸŸååˆ—è¡¨åŒ…å«å°ç¨‹åºåŸŸå
- æ£€æŸ¥è¯·æ±‚å¤´é…ç½®

### 3. HTTPS è¯ä¹¦é—®é¢˜
**é—®é¢˜**: SSL è¯ä¹¦é”™è¯¯

**è§£å†³**:
- ç¡®ä¿è¯ä¹¦æœ‰æ•ˆ
- æ£€æŸ¥è¯ä¹¦é“¾å®Œæ•´æ€§
- ä½¿ç”¨æœ‰æ•ˆçš„ CA ç­¾å‘çš„è¯ä¹¦

### 4. API è¯·æ±‚å¤±è´¥
**é—®é¢˜**: å°ç¨‹åºæ— æ³•è¯·æ±‚ API

**è§£å†³**:
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥é˜²ç«å¢™é…ç½®
- æ£€æŸ¥åŸŸåè§£æ
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

## ğŸ“ é…ç½®ç¤ºä¾‹

### å°ç¨‹åº API é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```javascript
// miniprogram/utils/api.js
const ENV = {
  development: 'http://localhost:8080',
  production: 'https://api.your-domain.com'
};

const isProduction = true;
const API_BASE_URL = isProduction ? ENV.production : ENV.development;
```

### åç«¯ CORS é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```go
// middleware/cors.go
allowOrigins := []string{
    "https://api.your-domain.com",
    "https://your-frontend-domain.com",
}
```

### Nginx é…ç½®ç¤ºä¾‹
```nginx
server {
    listen 443 ssl http2;
    server_name api.your-domain.com;
    
    ssl_certificate /etc/ssl/certs/your-domain.crt;
    ssl_certificate_key /etc/ssl/private/your-domain.key;
    
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## âœ… ä¸Šçº¿å‰æœ€ç»ˆæ£€æŸ¥

- [ ] API åœ°å€å·²æ”¹ä¸ºç”Ÿäº§åŸŸå
- [ ] å¾®ä¿¡å…¬ä¼—å¹³å°åŸŸåå·²é…ç½®
- [ ] åç«¯æœåŠ¡å·²é…ç½® HTTPS
- [ ] CORS é…ç½®å·²æ›´æ–°
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—é…ç½®æ­£ç¡®
- [ ] æœåŠ¡å™¨ç›‘æ§å·²é…ç½®
- [ ] å¤‡ä»½ç­–ç•¥å·²å®æ–½
- [ ] å®‰å…¨é…ç½®å·²æ£€æŸ¥
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å°ç¨‹åºä»£ç å·²ä¸Šä¼ 
- [ ] å®¡æ ¸å·²é€šè¿‡

---

**æç¤º**: å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒå®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼Œç¡®è®¤æ— è¯¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

